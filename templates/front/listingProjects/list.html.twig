{% extends 'base.html.twig' %}

{% block content %}
<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{%  block title %}Listes clients - {% block title_base %}{{ parent() }}{% endblock %}{% endblock %}</title>
</head>
	<body>
		<div class="container">
		<div class="mb-5"></div>
		<h1 class="text-center color-white">Liste clients</h1>	
		<div class="mb-3"></div>
		<div class="separator"></div>
		<div class="mb-5"></div>
			<div class="d-flex flex-row-reverse">
				<a href="{{ path('listing_projects_add') }}" title="Ajouter un site" type="button" class="btn-submit mb-3">
					Ajouter un site
				</a>
				&nbsp;
				<a href="{{ path('filter_add') }}" title="Ajouter un site" type="button" class="btn-submit mb-3">
					Ajouter un filtre
				</a>
			</div>
        	<nav class="rounded-pill verta navbar navbar-expand-lg mt-5 mb-5">
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
					<span class="" role="button" ><i class="fa fa-bars" aria-hidden="true" style="color:#e6e6ff"></i></span>
				</button>
				<div class="collapse navbar-collapse bg-blue-dark text-center p-4 rounded-pill id="navbarNav">
					<ul class="navbar-nav mx-auto">
						{% for filter in filters %}
							<li class="nav-item color-yellow mr-5">
								<input id="checkFilter{{filter.id}}" class="checkFilter" type="checkbox" value="{{filter.id}}">
								<label for="checkFilter{{filter.id}}" class="m-0" style="cursor: pointer">{{filter.name}}</label>
							</li>
						{% endfor %}
					</ul>
					<button class="btn-submit" onclick="validate()">Filtrer</button>
				</div>
			</nav>

			<table class="table mb-5 table-bordered" data-toggle="table" data-pagination="true">
				<thead class="bg-blue-dark-light table-borderless">
					<tr>
						<th class="color-yellow" scope="col">Nom de domaine</th>
						<th class="color-yellow" scope="col">Catégories</th>
						<th class="color-yellow" scope="col">Type de site</th>
						<th class="color-yellow"  scope="col">Action</th>
					</tr>
				</thead>
				<tbody class="bg-blue-dark align-middle">
					{% for listingProject in listingProjects %}
						<tr>
							<td class="verta"><a class=" color-white" href="http://{{ listingProject.domainname }}" target="new">{{ listingProject.domainname }}</td>
							<td class="verta color-white">
								{{listingProject.name}}
							</td>
							<td class="verta color-white">{{ listingProject.websitetype }}</td>
							<td>
								<a href="{{ path('listing_projects_modify', {"id": listingProject.id}) }}"><i class=" color-white fas fa-cog"></i></a>
								<span class="color-white">|</span>
								<a href="{{ path('listing_projects_detete', {"id": listingProject.id}) }}" onclick="return confirm('Attention vous vous apprettez à supprimer une étape')" title="Supprimer"><i class=" color-white fas fa-trash"></i></a>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		<script>
			let currentIds = '{{currentFilterId}}';
			if (currentIds) currentIds = currentIds.split(',');
			else currentIds = [];

			const defaultCheckedCheckoboxes = currentIds.map(id => document.querySelector('#checkFilter' + id));

			defaultCheckedCheckoboxes.forEach(c => c.checked = true);

			function validate() {
				const array = [];
				const checkboxes = document.querySelectorAll('.checkFilter:checked');
				checkboxes.forEach(c => array.push(c.value));
				window.location.href = 'liste-des-projets?filters=' + array.join(',');
			}
		</script>
	</body>
</html>
{% endblock %}